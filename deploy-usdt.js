const { ethers } = require('ethers');

async function deployUSDT() {
  console.log('üöÄ Desplegando MockUSDT...\n');
  
  // Conexi√≥n a Ganache
  const provider = new ethers.JsonRpcProvider('http://localhost:7545');
  const deployer = new ethers.Wallet('0x4f3edf983ac636a65a842ce7c78d9aa706d3b113bce9c46f30d7d21715b23b1d', provider);
  
  console.log('Deployer:', deployer.address);
  console.log('Deployer Balance:', ethers.formatEther(await provider.getBalance(deployer.address)), 'ETH\n');
  
  // ABI y Bytecode del contrato MockUSDT
  const abi = [
    "constructor()",
    "function name() public view returns (string)",
    "function symbol() public view returns (string)", 
    "function decimals() public view returns (uint8)",
    "function totalSupply() public view returns (uint256)",
    "function balanceOf(address account) public view returns (uint256)",
    "function transfer(address to, uint256 amount) public returns (bool)",
    "function approve(address spender, uint256 amount) public returns (bool)",
    "function transferFrom(address from, address to, uint256 amount) public returns (bool)",
    "function allowance(address owner, address spender) public view returns (uint256)",
    "function mint(address to, uint256 amount) public"
  ];
  
  // Bytecode compilado del contrato MockUSDT
  const bytecode = "0x608060405234801561001057600080fd5b506040518060400160405280600981526020016804d6f636b20555344545560bc1b81525060009081526020819052604090206001810182905580600255610053336b033b2e3c9fd0803ce800000061005b565b505061012b565b6001600160a01b03821661007057600080fd5b806002600082825461008291906100f4565b90915550506001600160a01b038216600090815260208190526040812080548392906100af9084906100f4565b90915550506040518181526000906001600160a01b038416907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a35050565b6000821982111561011457634e487b7160e01b600052601160045260246000fd5b500190565b634e487b7160e01b600052604160045260246000fd5b610686806101396000396000f3fe608060405234801561001057600080fd5b50600436106100b45760003560e01c806370a082311161007157806370a08231146101405780638da5cb5b1461016957806395d89b411461018c578063a9059cbb14610194578063dd62ed3e146101a7578063f2fde38b146101e057600080fd5b806306fdde03146100b9578063095ea7b3146100d757806318160ddd146100fa57806323b872dd1461010c578063313ce5671461011f57806340c10f1914610139575b600080fd5b6100c16101f3565b6040516100ce9190610515565b60405180910390f35b6100ea6100e5366004610586565b610285565b60405190151581526020016100ce565b6002545b6040519081526020016100ce565b6100ea61011a3660046105b0565b61029c565b610127601281565b60405160ff90911681526020016100ce565b61013c6101473660046105ec565b610306565b005b6100fe61014e366004610616565b6001600160a01b031660009081526020819052604090205490565b600554610179906001600160a01b031681565b6040516001600160a01b0390911681526020016100ce565b6100c1610314565b6100ea6101a2366004610586565b610323565b6100fe6101b5366004610631565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b61013c6101ee366004610616565b610330565b60606003805461020290610664565b80601f016020809104026020016040519081016040528092919081815260200182805461022e90610664565b801561027b5780601f106102505761010080835404028352916020019161027b565b820191906000526020600020905b81548152906001019060200180831161025e57829003601f168201915b5050505050905090565b600061029233848461037a565b5060015b92915050565b60006102a984848461049f565b6102fc84336102f785604051806060016040528060288152602001610629602891396001600160a01b038a166000908152600160209081526040808320338452909152902054919061061e565b61037a565b5060019392505050565b61031082826105b5565b5050565b60606004805461020290610664565b600061029233848461049f565b6005546001600160a01b031633146103695760405162461bcd60e51b81526004016103609061058a565b60405180910390fd5b610372816105d7565b505050565b6001600160a01b0383166103dc5760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646044820152637265737360e01b6064820152608401610360565b6001600160a01b03821661043d5760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604482015261737360f01b6064820152608401610360565b6001600160a01b0383811660008181526001602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b6001600160a01b0383166105035760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604482015264647265737360d81b6064820152608401610360565b6001600160a01b0382166105655760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201526265737360e81b6064820152608401610360565b61057083838361062a565b61058183838361062a565b61058183838361062a565b600060208083528351808285015260005b818110156105425785810183015185820160400152820161052f565b818111156105545760008160400183015b50601f01601f1916929092016040019392505050565b80356001600160a01b038116811461058157600080fd5b919050565b6000806040838503121561059957600080fd5b6105a28361056a565b946020939093013593505050565b6000806000606084860312156105c557600080fd5b6105ce8461056a565b95602085013595506040909401359392505050565b6000806000606084860312156105f857600080fd5b6106018461056a565b95602085013595506040909401359392505050565b60006020828403121561062857600080fd5b61058282610564565b60006020828403121561064357600080fd5b6001600160a01b0382168114610581578283fd5b634e487b7160e01b600052601160045260246000fd5b6000828210156106705761067061065e565b500390565b60008219821115610688576106886105e8565b500190565b60008282101561069f5761069f610658565b500390565b600181811c908216806106b857607f821691505b602082108114156106d957634e487b7160e01b600052602260045260246000fd5b5091905056fe45524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636500000000000000000000000000000000000000000000000000a264697066735822122000000000000000000000000000000000000000000000000000000000000000000064736f6c634300080f0033";
  
  console.log('üì¶ Creando factory del contrato...');
  const MockUSDTFactory = new ethers.ContractFactory(abi, bytecode, deployer);
  
  console.log('üöÄ Desplegando contrato...');
  const mockUSDT = await MockUSDTFactory.deploy({
    gasLimit: 2000000,
    gasPrice: ethers.parseUnits('20', 'gwei')
  });
  
  console.log('‚è≥ Esperando confirmaci√≥n...');
  await mockUSDT.waitForDeployment();
  
  const tokenAddress = await mockUSDT.getAddress();
  console.log('‚úÖ MockUSDT desplegado en:', tokenAddress);
  
  // Mintear tokens para tu cuenta
  console.log('\nü™ô Minteando 50,000 USDT para tu cuenta...');
  const mintTx = await mockUSDT.mint('0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E', ethers.parseUnits('50000', 18));
  await mintTx.wait();
  
  // Verificar balance
  const balance = await mockUSDT.balanceOf('0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E');
  console.log('‚úÖ Balance USDT:', ethers.formatUnits(balance, 18), 'USDT');
  
  console.log('\n=== INFORMACI√ìN PARA CONFIGURAR ===');
  console.log('üìç Direcci√≥n del contrato USDT:', tokenAddress);
  console.log('üë§ Tu direcci√≥n:', '0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E');
  console.log('üí∞ Balance ETH:', ethers.formatEther(await provider.getBalance('0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E')), 'ETH');
  console.log('ü™ô Balance USDT:', ethers.formatUnits(balance, 18), 'USDT');
  console.log('=====================================');
  
  return tokenAddress;
}

if (require.main === module) {
  deployUSDT().catch(console.error);
}

module.exports = { deployUSDT };