const { ethers } = require('ethers');

async function deploySimpleUSDT() {
  const provider = new ethers.JsonRpcProvider('http://localhost:7545');
  const deployer = new ethers.Wallet('0x4f3edf983ac636a65a842ce7c78d9aa706d3b113bce9c46f30d7d21715b23b1d', provider);
  
  console.log('üöÄ Desplegando MockUSDT super simple...');
  console.log('Deployer:', deployer.address);
  
  // Contrato ERC20 minimalista que funciona
  const abi = [
    "constructor(uint256 _totalSupply)",
    "function balanceOf(address account) view returns (uint256)",
    "function transfer(address to, uint256 amount) returns (bool)",
    "function approve(address spender, uint256 amount) returns (bool)",
    "function allowance(address owner, address spender) view returns (uint256)",
    "function transferFrom(address from, address to, uint256 amount) returns (bool)",
    "function name() view returns (string)",
    "function symbol() view returns (string)", 
    "function decimals() view returns (uint8)"
  ];
  
  // Bytecode de un ERC20 b√°sico que funciona en Ganache
  const bytecode = "0x608060405234801561001057600080fd5b5060405161088038038061088083398101604081905261002f91610054565b33600090815260208190526040902055600155610074565b60006020828403121561006657600080fd5b5051919050565b6107fd806100836000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c806370a082311161006657806370a08231146101145780638da5cb5b1461013d57806395d89b411461015d578063a9059cbb14610165578063dd62ed3e1461017857600080fd5b806306fdde0314610098578063095ea7b3146100b657806318160ddd146100d957806323b872dd146100f8575b600080fd5b6100a06101bb565b6040516100ad9190610659565b60405180910390f35b6100c96100c43660046106c3565b6101f2565b60405190151581526020016100ad565b6001546040519081526020016100ad565b6100c96101063660046106ef565b610209565b6100e16101223660046106ef565b6001600160a01b031660009081526020819052604090205490565b61014561027b565b6040516001600160a01b0390911681526020016100ad565b6100a06102a0565b6100c96101733660046106c3565b6102d7565b6100e161018636600461072b565b6001600160a01b03918216600090815260026020908152604080832093909416825291909152205490565b60606040518060400160405280600981526020016804d6f636b20555344545560bc1b815250905090565b60006101ff3384846102e4565b5060015b92915050565b6001600160a01b03831660009081526002602090815260408083203384529091528120548211156102495760405162461bcd60e51b815260040161024090610723565b60405180910390fd5b610254858585610371565b61026e853361026985856107a8565b6102e4565b5060019695505050505050565b600080546001600160a01b0316330361029857506000546001600160a01b031690565b506000919050565b60606040518060400160405280600481526020016355534454608c1b815250905090565b60006101ff338484610371565b6001600160a01b0383166103335760405162461bcd60e51b815260206004820152601660248201527522a9219b99189d1030b8383937bb32903a379036b4b73a1760511b6044820152606401610240565b6001600160a01b0382166103815760405162461bcd60e51b8152602060048201526015602482015274151c985b9cd9995c8819985a5b1959081a5b9c1d5d605a1b6044820152606401610240565b6001600160a01b0383811660008181526002602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b6001600160a01b0383166103c55760405162461bcd60e51b815260206004820152601660248201527522a9219b99189d1030b8383937bb32903a379036b4b73a1760511b6044820152606401610240565b6001600160a01b0382166104135760405162461bcd60e51b8152602060048201526015602482015274151c985b9cd9995c8819985a5b1959081a5b9c1d5d605a1b6044820152606401610240565b6001600160a01b0383166000908152602081905260409020548181101561047c5760405162461bcd60e51b815260206004820152601a60248201527f496e73756666696369656e742062616c616e636520746f6b656e0000000000006044820152606401610240565b6001600160a01b0380851660008181526020819052604080822086860390559286168082529083902080548601905591517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef906104dc9086815260200190565b60405180910390a350505050565b600060208083528351808285015260005b81811015610517578581018301518582016040015282016104fb565b81811115610529576000604083870101525b50601f01601f1916929092016040019392505050565b80356001600160a01b038116811461055657600080fd5b919050565b6000806040838503121561056e57600080fd5b6105778361053f565b946020939093013593505050565b6000806000606084860312156105a657600080fd5b6105af8461053f565b92506105bd6020850161053f565b9150604084013590509250925092565b6000602082840312156105df57600080fd5b6105e88261053f565b9392505050565b600080604083850312156105f557600080fd5b6105fe8361053f565b915061060c6020840161053f565b90509250929050565b634e487b7160e01b600052601160045260246000fd5b60008282101561064357610643610615565b500390565b6000821982111561065b5761065b610615565b500190565b60006020808352835180829085018501918603018082018360005b838110156106b55781516001600160a01b0316875295820195908201906001016106d8565b505091505090";

  try {
    const factory = new ethers.ContractFactory(abi, bytecode, deployer);
    
    // Desplegar con supply inicial
    console.log('üì¶ Desplegando contrato...');
    const totalSupply = ethers.parseUnits('1000000', 18); // 1M tokens
    const contract = await factory.deploy(totalSupply, {
      gasLimit: 2000000,
      gasPrice: ethers.parseUnits('20', 'gwei')
    });
    
    await contract.waitForDeployment();
    const address = await contract.getAddress();
    
    console.log('‚úÖ MockUSDT desplegado en:', address);
    
    // Verificar balance del deployer
    const deployerBalance = await contract.balanceOf(deployer.address);
    console.log('üí∞ Balance del deployer:', ethers.formatUnits(deployerBalance, 18), 'USDT');
    
    // Transferir tokens a tu cuenta MetaMask
    console.log('üîÑ Transfiriendo 50,000 USDT a tu MetaMask...');
    const tx = await contract.transfer('0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E', ethers.parseUnits('50000', 18));
    await tx.wait();
    
    const yourBalance = await contract.balanceOf('0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E');
    console.log('‚úÖ Tu balance USDT:', ethers.formatUnits(yourBalance, 18), 'USDT');
    
    console.log('\nüéØ INFORMACI√ìN PARA METAMASK:');
    console.log('Direcci√≥n del token:', address);
    console.log('S√≠mbolo: USDT');
    console.log('Decimales: 18');
    console.log('Tu cuenta:', '0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E');
    
    return address;
  } catch (error) {
    console.error('‚ùå Error:', error.message);
    return null;
  }
}

deploySimpleUSDT();