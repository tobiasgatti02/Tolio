#!/usr/bin/env node

const { ethers } = require('ethers');

async function main() {
  const provider = new ethers.JsonRpcProvider('http://localhost:7545');
  const deployer = new ethers.Wallet('0x4f3edf983ac636a65a842ce7c78d9aa706d3b113bce9c46f30d7d21715b23b1d', provider);
  
  console.log('Deployer:', deployer.address);
  
  // Contrato USDT simple
  const abi = [
    "constructor()",
    "function balanceOf(address) view returns (uint256)",
    "function transfer(address, uint256) returns (bool)",
    "function approve(address, uint256) returns (bool)",
    "function allowance(address, address) view returns (uint256)",
    "function name() view returns (string)",
    "function symbol() view returns (string)",
    "function decimals() view returns (uint8)"
  ];

  const bytecode = "0x608060405234801561001057600080fd5b50600080546001600160a01b031916331790556040518060400160405280600981526020016804d6f636b20555344545560bc1b815250600190816100549190610111565b506040518060400160405280600481526020016355534454608c1b8152506002908161007f9190610111565b50601260035569d3c21bcecceda10000006004819055336000908152600560205260409020556101d0565b634e487b7160e01b600052604160045260246000fd5b600181811c908216806100d157607f821691505b6020821081036100f157634e487b7160e01b600052602260045260246000fd5b50919050565b601f82111561010c57600081815260208120601f850160051c8101602086101561011e5750805b601f850160051c820191505b8181101561013d5782815560010161012a565b505050505050565b81516001600160401b0381111561015e5761015e6100a7565b6101728161016c84546100bd565b846100f7565b602080601f8311600181146101a7576000841561018f5750858301515b600019600386901b1c1916600185901b17855561013d565b600085815260208120601f198616915b828110156101d6578886015182559484019460019091019084016101b7565b50858210156101f45787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b610318806102136000396000f3fe608060405234801561001057600080fd5b50600436106100885760003560e01c806370a082311161005b57806370a08231146100fe57806395d89b411461012e578063a9059cbb14610136578063dd62ed3e1461014957600080fd5b806306fdde031461008d578063095ea7b3146100ab57806318160ddd146100ce57806323b872dd146100eb575b600080fd5b610095610189565b6040516100a291906102a1565b60405180910390f35b6100be6100b9366004610266565b610217565b60405190151581526020016100a2565b6100dd60045481565b6040519081526020016100a2565b6100be6100f9366004610230565b61022e565b6100dd61010c36600461021b565b6001600160a01b031660009081526005602052604090205490565b6100956102b0565b6100be610144366004610266565b6102bd565b6100dd610157366004610230565b6001600160a01b03918216600090815260066020908152604080832093909416825291909152205490565b60606001805461019890610290565b80601f01602080910402602001604051908101604052809291908181526020018280546101c490610290565b80156102115780601f106101e657610100808354040283529160200191610211565b820191906000526020600020905b8154815290600101906020018083116101f457829003601f168201915b50505050509050565b600061022433848461030a565b5060015b92915050565b600061023b85858561035e565b61025885336102538660405180606001604052806028815260200161031860289139886001600160a01b0316600090815260066020908152604080832033845290915290205491906103f3565b61030a565b506001949350505050565b8035610228816104ae565b6000806040838503121561027957600080fd5b610282836102b0565b9150602083013590509250929050565b60008060006060848603121561024257600080fd5b610250846102b0565b925061025e602085016102b0565b9150604084013590509250925092565b600060208284031215610280576102c8565b6102d18261022e565b9392505050565b60006020808352835180829085019082018360005b8381101561030957815185529382019390820190600101610304565b50500195945050505050565b6001600160a01b038316600090815260056020526040902054818110156103495760405162461bcd60e51b815260206004820152600181526060602482015260031b60e01b60448201526064015b60405180910390fd5b61035384846103ab565b50505050565b6001600160a01b03831660009081526006602090815260408083203384529091529020548281101561038c5760405162461bcd60e51b815260206004820152600181526060602482015260006006820152608401610340565b6103978433836103ab565b6103a2858585610425565b95945050505050565b6001600160a01b03928316600081815260066020908152604080832094909516825292909252918290208490558151848152915190917f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925919081900360200190a35050565b600081848411156104175760405162461bcd60e51b815260040161034091906102a1565b505050900390565b6001600160a01b03831660009081526005602052604090205481811015610453576040516bffffffffffffffffffffffff19606084901b16815260040161034090602080825260009082015260400190565b6001600160a01b03808516600090815260056020526040808220858503905591851681529081208054849290610480908490610496565b92505081905550826001600160a01b0316846001600160a01b0316600080516020610338833981519152846040516104b791815260200190565b60405180910390a350600190565b634e487b7160e01b600052601160045260246000fd5b600082198211156104d3576104d36104be565b500190565b6001600160a01b0381168114610228576000825160005b81811015610509578082015183820152602001610504565b50600019928301920155fe45524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e6365a26469706673582212200000000000000000000000000000000000000000000000000000000000000000064736f6c634300080f0033";

  try {
    console.log('üì¶ Desplegando MockUSDT...');
    
    const factory = new ethers.ContractFactory(abi, bytecode, deployer);
    const contract = await factory.deploy();
    await contract.waitForDeployment();
    const address = await contract.getAddress();
    
    console.log('‚úÖ USDT desplegado en:', address);
    
    // Transfer tokens to your account
    console.log('ü™ô Transfiriendo 50,000 USDT...');
    const tx = await contract.transfer('0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E', ethers.parseUnits('50000', 18));
    await tx.wait();
    
    const balance = await contract.balanceOf('0x03A4CCf306B0a22175b7781f24F95Fa5cdBE634E');
    console.log('‚úÖ Tu balance:', ethers.formatUnits(balance, 18), 'USDT');
    
    console.log('\n=== INFORMACI√ìN PARA METAMASK ===');
    console.log('Direcci√≥n del token:', address);
    console.log('S√≠mbolo: USDT');
    console.log('Decimales: 18');
    console.log('================================');
    
    return address;
  } catch (error) {
    console.error('‚ùå Error:', error);
  }
}

main();